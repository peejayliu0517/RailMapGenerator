(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{24:function(t,e,n){"use strict";n.r(e);var i=n(0),s=n(6),r=n(2);function a(t,e){let n=t[r.b.colour],i=t[r.b.fg],s=[t[r.b.nameZH],t[r.b.nameEN]],a=s[0].match(/[\d]+|[\D]+/g)||[""],h=!1;2==a.length&&!isNaN(Number(a[0]))&&isNaN(Number(a[1]))&&(h=!0);let l=$("<g>").append($("<use>",{"xlink:href":"#intbox_gz",fill:-1===e?"#aaa":n})).append($("<text>",{y:8.5,class:"rmg-name__zh rmg-name__gzmtr--int"}).append($("<tspan>",{"font-size":"16px","dominant-baseline":"central"}).text(h?a[0]:"")).append($("<tspan>",{dy:-1,"dominant-baseline":"central"}).text(h?a[1]:a.join("")))).append($("<text>",{y:19.5,class:"rmg-name__en"}).addClass(s[1].length>10?"rmg-name__gzmtr--int-small":"rmg-name__gzmtr--int").text(s[1]));return"#fff"===i||-1===e?$(l).find("text").attr("fill","#fff"):$(l).find("text").attr("fill",i),l}class h extends s.a{constructor(t,e){super(t,e),this.stnNum=e.num}get nameClass(){switch(this.state){case-1:return"Pass";case 0:return"CurrentGZ";default:return"Future"}}get _nameShift(){return!1}get _tickRotation(){return this.y>0?180:0}get iconHTML(){var[t,e]=-1==this.state?["rmg-stn--pass","Pass"]:["rmg-stn--future","Future"];return $("<g>",{transform:`translate(${this.x},${this.y})`}).append($("<use>",{"xlink:href":"#stn_gz",class:t})).append($("<g>",{class:"Name "+e}).append($("<text>",{class:"rmg-name__zh rmg-name__gzmtr--line-num"})).append($("<text>",{class:"rmg-name__zh rmg-name__gzmtr--station-num",x:0}).text(this.stnNum)))}get nameHTML(){var t=this.name[1].split("\\").length;let e;e=this._nameShift?0===this._tickRotation?-9:16+12*(t-1)*Math.cos(-45):0===this._tickRotation?(24+12*(t-1))*Math.cos(-45):-6;let n=0===this._tickRotation?-25.921875-12*(t-1)*Math.cos(-45):17.5,i=$("<g>",{class:"Name "+this.nameClass}).append($("<text>").addClass("rmg-name__zh rmg-name__gzmtr--station").text(this.name[0])).append($("<text>",{dy:15,class:"rmg-name__en rmg-name__gzmtr--station"}).text(this.name[1].split("\\")[0]).append($("<tspan>",{x:0,dy:10,class:"rmg-name__en rmg-name__gzmtr--station"}).text(this.name[1].split("\\")[1])));return $("<g>",{id:"stn_name",transform:`translate(${this.x-e},${this.y+n})rotate(-45)`,"text-anchor":0===this._tickRotation?"start":"end"}).append(i)}get expressTagHTML(){if(!this.services.has("express"))return $("<g>");let t=$(`#stn_icons #${this.id} g#stn_name g`)[0].getBBox();return $("<g>",{transform:`translate(${(t.width+35)*(0===this._tickRotation?1:-1)},${2+5*(this.name[1].split("\\").length-1)})`,fill:-1===this.state?"#aaa":"var(--rmg-theme-colour)","text-anchor":"middle"}).append($("<text>",{class:"rmg-name__zh rmg-name__gzmtr--express"}).text("快车停靠站")).append($("<text>",{y:10,class:"rmg-name__en rmg-name__gzmtr--express"}).text("Express Station"))}}class l extends h{constructor(t,e){super(t,e),this._intInfos=e.transfer.info[0]}get intTickHTML(){var t=this._intInfos.map(t=>t[r.b.colour]).map((t,e)=>{let n=this.x-2*(this._intInfos.length-1)+4*e;return $("<use>",{"xlink:href":"#inttick_gz",stroke:-1==this.state?"#aaa":t,transform:`translate(${n},${this.y})rotate(${this._tickRotation})`})});return $("<g>",{class:"rmg-line rmg-line__gzmtr rmg-line__change"}).append(...t)}get intNameHTML(){let t=this._intInfos.map(t=>a(t,this.state));return t.forEach((t,e)=>{$(t).attr("transform",`translate(0,${28*e*(0===this._tickRotation?1:-1)})`)}),$("<g>",{"text-anchor":"middle",transform:`translate(${this.x},${this.y+(0===this._tickRotation?23:-47)})`}).append(...t)}get ungrpHTML(){return[this.intTickHTML,this.iconHTML,this.nameHTML,this.intNameHTML]}}class _ extends l{constructor(t,e,n){e.transfer.info[0].unshift(n),e.transfer.info[1]&&e.transfer.info[0].push(...e.transfer.info[1]),super(t,e)}set lineInfo(t){this._intInfos[0]=t}get _nameShift(){return!0}get _tickRotation(){return 0===this.parents.indexOf(this.branch.left[1])||0===this.children.indexOf(this.branch.right[1])?0:180}}class d extends l{constructor(t,e){super(t,e)}}var g=n(5);n.d(e,"RMGLineGZ",(function(){return m}));class m extends g.a{constructor(t){super(t),this._psdNum=t.psd_num,this._lineNum=t.line_num,this.infoPanelType=t.info_panel_type,this.directionGZX=t.direction_gz_x,this.directionGZY=t.direction_gz_y}_initStnInstance(t,e){if(2===e.children.length||2===e.parents.length)return new _(t,e,[this.themeCity,this.themeLine,"var(--rmg-theme-colour)","var(--rmg-theme-fg)",...this._lineNames]);switch(e.transfer.type){case"int2":case"int3":return new l(t,e);case"osi11":case"osi12":case"osi13":case"osi21":case"osi22":case"osi31":return new d(t,e);default:return new h(t,e)}}get lineXs(){return"r"==this._direction?[this._svgWidth*this._padding/100+65,this._svgWidth*(1-this._padding/100)-20]:[this._svgWidth*this._padding/100,this._svgWidth*(1-this._padding/100)-65]}set svgWidth(t){super.svgWidth=t,this.loadLineNum(),this.loadLineName(),this.loadDirection()}set padding(t){super.padding=t,this.loadLineNum(),this.loadLineName()}set branchSpacing(t){super.branchSpacing=t,this.loadLineNum()}set direction(t){this._direction=t,Object(i.k)("direction",t);for(let[t,e]of Object.entries(this.stations))["linestart","lineend"].includes(t)||this._updateStnInstance(t);m.clearSVG(),this.drawStns(),this.drawLine(),this.drawDestInfo(),this.loadLineNum(),this.loadLineName(),this.loadDirection()}set currentStnId(t){super.currentStnId=t,this.loadLineNum(),this.loadDirection()}set lineNum(t){this._lineNum=t,Object(i.k)("line_num",t),this.loadLineNum()}set lineNames(t){this._lineNames=t,Object(i.k)("line_name",t),this.loadLineName();for(let[t,e]of Object.entries(this.stations))["linestart","lineend"].includes(t)||e instanceof _&&(e.lineInfo=[this.themeCity,this.themeLine,this._themeColour,this._fgColour,this._lineNames[0],this._lineNames[1]],this.redrawStn(t),this.loadLineNum())}set psdNum(t){this._psdNum=t,Object(i.k)("psd_num",t),$("g#big_psd text").eq(0).text(t)}set infoPanelType(t){let e;this._infoPanelType=t,Object(i.k)("info_panel_type",t),$("#run_in_gzmtr #indicator_light").attr("xlink:href","#indicator_"+t),this.drawStrip(),["gz3","gz1421"].includes(this._infoPanelType)?($("#big_psd use").css("fill","var(--rmg-theme-colour)"),$("#big_psd").css("fill","var(--rmg-theme-fg)"),e="gz3"===t?"82px":"62px"):($("#big_psd use").css("fill","white"),$("#big_psd").css("fill","#000"),e="58px"),$("#run_in_gzmtr #big_psd").css("--psd-dy",e)}set directionGZX(t){this._directionGZX=t,Object(i.k)("direction_gz_x",t),$("#direction_gz").css("--x-percentage",t.toString())}set directionGZY(t){this._directionGZY=t,Object(i.k)("direction_gz_y",t),$("#direction_gz").css("--y-percentage",t.toString())}_stnXShare(t){let{criticalPath:e,branches:n}=this,i=this;if(e.nodes.includes(t))return super._stnXShare(t);if(this.criticalPath.nodes.join(",")!==n[0].join(","))return super._stnXShare(t);{let e=n.slice(1).filter(e=>e.includes(t))[0],s=this._cp(e[0],t).len,r=this._cp(t,e[e.length-1]).len;return n[0].includes(e[0])&&n[0].includes(e[e.length-1])?(i._stnXShare(e[0])*r+i._stnXShare(e[e.length-1])*s)/(s+r):n[0].includes(e[0])?i._stnXShare(e[0])+s:i._stnXShare(e[e.length-1])-r}}_stnYShare(t){if(["linestart","lineend"].includes(t))return 0;var e=this.branches;if(e[0].includes(t))return 0;{let s=1;for(;s<e.length&&!e[s].includes(t);)s++;if(e[0].includes(e[s][0])){var n=e[s][0],i="children";return 0==this.stations[n][i].indexOf(e[s][1])?2:-2}n=e[s].slice().reverse()[0],i="parents";return 0==this.stations[n][i].indexOf(e[s].slice().reverse()[1])?2:-2}}drawStrip(){let t=(t=>{switch(this._infoPanelType){case"gz28":case"gzgf":return 60;case"gz3":return 40;case"gz1421":return 20}})();$("rect#strip_gz").css("--height",t)}_rightWideFactor(t){return this.stations[t]instanceof _&&0===this.stations[t]._tickRotation?.25:0}_leftWideFactor(t){return this.stations[t]instanceof _&&0!==this.stations[t]._tickRotation?.25:0}_pathWeight(t,e){return this.stations[t].children.includes(e)?1+this._rightWideFactor(t)+this._leftWideFactor(e):-1/0}drawStns(){for(let[t,e]of Object.entries(this.stations))["linestart","lineend"].includes(t)||$("#stn_icons").append(e.html);$("#stn_icons").html($("#stn_icons").html());for(let[t,e]of Object.entries(this.stations))["linestart","lineend"].includes(t)||$(`#stn_icons #${t} g#stn_name`).append(e.expressTagHTML);$("#stn_icons").html($("#stn_icons").html())}redrawStn(t){$("#stn_icons").find("#"+t).remove(),$("#stn_icons").append(this.stations[t].html),$("#stn_icons").html($("#stn_icons").html()),$(`#stn_icons #${t} g#stn_name`).append(this.stations[t].expressTagHTML),$(`#stn_icons #${t} g#stn_name`).html($(`#stn_icons #${t} g#stn_name`).html())}_linePath(t){let e;var n=[];return t.forEach(t=>{var[i,s]=["_stnRealX","_stnRealY"].map(e=>this[e](t));if(!e&&0!==e)return e=s,void n.push(`M ${i},${s}`);0===s?(s<e&&n.push(`H ${i-30}`,"a 30,30 0 0,0 30,-30",`V ${s}`),s>e&&n.push(`H ${i-30}`,"a 30,30 0 0,1 30,30",`V ${s}`)):(s<e&&n.push(`V ${s+30}`,"a 30,30 0 0,1 30,-30",`H ${i}`),s>e&&n.push(`V ${s-30}`,"a 30,30 0 0,0 30,30",`H ${i}`)),n.push(`H ${i}`),e=s}),n.join(" ").replace(/( H ([\d.]+))+/g," H $2")}drawLine(){$(".rmg-line").removeClass("rmg-line__mtr").addClass("rmg-line__gzmtr"),super.drawLine()}initFonts(){let t=$("link#css_share")[0].sheet,e=[];Array.from(t.cssRules).forEach((t,n)=>{-1!==t.cssText.indexOf(".rmg-name__zh")?e.push(n):-1!==t.cssText.indexOf(".rmg-name__en")&&e.push(n)}),e.forEach(e=>t.deleteRule(e)),t.insertRule(".rmg-name__zh {alignment-baseline: central; font-family: Arial, SimHei, STHeiti, PingFangSC-Regular, sans-serif;}"),t.insertRule(".rmg-name__en {alignment-baseline: middle; font-family: Arial, sans-serif;}")}loadLineNum(){$(".rmg-name__gzmtr--line-num").text(this._lineNum).attr("transform","translate(-9.25,0)");var t=Object(i.g)($(".rmg-name__gzmtr--line-num")[1],"railmap");if(2===this._lineNum.length){var e=t.width>15.59375?15.59375/t.width:1;$(".rmg-name__gzmtr--line-num").attr("transform",`translate(-9.25,0)scale(${e})`),$(".rmg-name__gzmtr--station-num").attr("transform",`translate(9.25,0)scale(${e})`)}else{e=t.width>15.59375?15.59375/t.width:1;$(".rmg-name__gzmtr--line-num").attr("transform",`translate(-9.25,0)scale(${e})`),$(".rmg-name__gzmtr--station-num").attr("transform","translate(9.25,0)")}}loadLineName(){let t=[this.themeCity,this.themeLine,"var(--rmg-theme-colour)","var(--rmg-theme-fg)",this._lineNames[0],this._lineNames[1]];$("#line_name").empty().append(a(t,1)),$("#line_name").html($("#line_name").html()).css("--translate-x","r"==this._direction?this.lineXs[0]-65:this.lineXs[1]+65)}loadDirection(){let t;if("l"==this._direction?($("#direction_gz use").css("--rotate","0deg"),$("#direction_gz g").attr({"text-anchor":"start",transform:"translate(65,-5)"}),t=this.lValidDests):($("#direction_gz use").css("--rotate","180deg"),$("#direction_gz g").attr({"text-anchor":"end",transform:"translate(-65,-5)"}),t=this.rValidDests),2!==t.length){var[e,n]=[0,1].map(e=>t.map(t=>this.stations[t].name[e].replace(/\\/g," ")).join("/"));$("#direction_gz g").eq(0).find("text").eq(0).text(e+"方向"),$("#direction_gz g").eq(0).find("text").eq(1).text("Towards "+n.replace("\\"," ")),$("#direction_gz g").eq(0).show(),$("#direction_gz g").eq(1).hide()}else{t.map(t=>this.stations[t].name).reduce((t,e)=>t.concat(e),[]).forEach((t,e)=>{e%2&&(t="Towards "+t.replace("\\"," ")),$("#direction_gz g").eq(1).find("text").eq(e).text(t)}),$("#direction_gz g").eq(1).find("text").css("letter-spacing",0);let e=t.map(t=>this.stations[t].name[0].length),n=Math.min(...e);if(n>1&&e[0]!==e[1]){let t=Math.abs(e[0]-e[1])/(n-1);$("#direction_gz g").eq(1).find("text").eq(e[0]>e[1]?2:0).css("letter-spacing",`${t}em`)}if("l"===this._direction){let t=Math.max(...e);$("#direction_gz g").eq(1).find("text").eq(4).attr("x",25*(t+1)),$("#direction_gz g").eq(1).find("text").slice(0,4).removeAttr("x")}else $("#direction_gz g").eq(1).find("text").eq(4).removeAttr("x"),$("#direction_gz g").eq(1).find("text").slice(0,4).attr("x","-75");$("#direction_gz g").eq(0).hide(),$("#direction_gz g").eq(1).show()}}updateStnName(t,e){super.updateStnName(t,e),$(`#stn_icons #${t} g#stn_name`).append(this.stations[t].expressTagHTML),$("#stn_icons").html($("#stn_icons").html()),this.loadLineNum(),(this.stations[this._currentStnId].parents.includes(t)||this.stations[this._currentStnId].children.includes(t))&&this.drawDestInfo(),this._currentStnId===t&&this.drawDestInfo(),(this.leftDests.includes(t)||this.rightDests.includes(t))&&this.loadDirection()}updateStnNum(t,e){this.stations[t].stnNum=e;let n=Object(i.d)();n.stn_list[t].num=e,Object(i.i)(n),this.redrawStn(t),this.loadLineNum(),this._currentStnId===t&&this.drawDestInfo()}updateStnServices(t,e){super.updateStnServices(t,e),$(`#stn_icons #${t}`).remove(),$("#stn_icons").append(this.stations[t].html),$("#stn_icons").html($("#stn_icons").html()),$(`#stn_icons #${t} g#stn_name`).append(this.stations[t].expressTagHTML),$("#stn_icons").html($("#stn_icons").html()),this.loadLineNum()}drawDestInfo(){$("#run_in_gzmtr #big_stn_num text").eq(1).text(this.stations[this._currentStnId].stnNum),$("#run_in_gzmtr > #platform > text").eq(0).text(this._platformNum),$("#run_in_gzmtr > #big_psd text").eq(0).text(this._psdNum),$("#run_in_gzmtr #big_name").empty().css("--translate-y",.5*this._svgHeight-50-18*(this.stations[this._currentStnId].name[1].split("\\").length-1)).append($("<text>",{class:"rmg-name__zh"}).text(this.stations[this._currentStnId].name[0])).append($("<text>",{dy:70,class:"rmg-name__en"}).text(this.stations[this._currentStnId].name[1].split("\\")[0]).append($("<tspan>",{x:0,dy:36,"dominant-baseline":"middle"}).text(this.stations[this._currentStnId].name[1].split("\\")[1]||"")));let t=this.stations[this._currentStnId]["l"===this._direction?"parents":"children"].filter(t=>(this.stations[this._currentStnId].branch["l"===this._direction?"left":"right"].length,!0));["linestart","lineend"].includes(t[0])?($("#run_in_gzmtr").find("#big_next, #big_next_2").hide(),$("#run_in_gzmtr > use").eq(0).hide(),$("#line_main, #line_pass, #line_name, #stn_icons, #direction_gz").hide(),$("#terminus_gz").show()):(1===t.length?($("#run_in_gzmtr #big_next").show(),$("#run_in_gzmtr #big_next_2").hide()):($("#run_in_gzmtr #big_next").hide(),$("#run_in_gzmtr #big_next_2").show()),$("#run_in_gzmtr > use").eq(0).show(),$("#line_main, #line_pass, #line_name, #stn_icons, #direction_gz").show(),$("#terminus_gz").hide());let[e,n]=["",""],s=0;if(1===t.length){var r=this.stations[t[0]];[e,n]=r.name,s=e.length,$("#run_in_gzmtr #big_next g:nth-child(2) text").eq(0).text(e),$("#run_in_gzmtr #big_next g:nth-child(2) text").eq(1).text(n.split("\\")[0]).append($("<tspan>",{x:0,dy:17,"alignment-baseline":"middle"}).text(n.split("\\")[1]||""))}else t.forEach((t,i)=>{let r=this.stations[t];[e,n]=r.name,e.length>s&&(s=e.length),$(`#run_in_gzmtr #big_next_2 g:nth-child(${2*(i+1)}) text`).eq(0).text(e),$(`#run_in_gzmtr #big_next_2 g:nth-child(${2*(i+1)}) text`).eq(1).text(n.split("\\")[0]).append($("<tspan>",{x:0,dy:13,"alignment-baseline":"middle"}).text(n.split("\\")[1]||""));let a,h=this.routes.filter(e=>-1!==e.indexOf(t)).map(t=>t.filter(t=>"linestart"!==t&&"lineend"!==t));a="l"===this._direction?Array.from(new Set(h.map(t=>t[0]))).reverse():Array.from(new Set(h.map(t=>t.reverse()[0]))),$(`#run_in_gzmtr #big_next_2 g:nth-child(${2*(i+1)}) text`).eq(2).text(a.map(t=>this.stations[t].name[0]).join("/")+"方向"),$(`#run_in_gzmtr #big_next_2 g:nth-child(${2*(i+1)}) text`).eq(3).text("Towards "+a.map(t=>this.stations[t].name[1]).join("/"))});$("#run_in_gzmtr").html($("#run_in_gzmtr").html());var a=Object(i.g)($("#run_in_gzmtr #big_name text")[0],"runin");$("#run_in_gzmtr #big_stn_num").css({"--translate-x":(this._svgDestWidth+a.width)/2+55,"--translate-y":.5*this._svgHeight-30-18*(this.stations[this._currentStnId].name[1].split("\\").length-1)});let h={x:0,y:0,width:0,height:0};if(1===t.length)h=Object(i.g)($("#run_in_gzmtr #big_next g:nth-child(2)")[0],"runin");else{let t=[Object(i.g)($("#run_in_gzmtr #big_next_2 g:nth-child(2)")[0],"runin"),Object(i.g)($("#run_in_gzmtr #big_next_2 g:nth-child(4)")[0],"runin")];h=t[0].width>t[1].width?t[0]:t[1]}"l"==this._direction?($("#run_in_gzmtr #platform").css("--translate-x",this._svgDestWidth-100),1===t.length?s<=2?($("#run_in_gzmtr #big_next g:nth-child(2)").css("--translate-x",150),$("#run_in_gzmtr use#arrow").css({"--translate-x":(115+35*(1+s)+a.x)/2-20,"--rotate":"0deg"})):($("#run_in_gzmtr #big_next g:nth-child(2)").css("--translate-x",132.5),$("#run_in_gzmtr use#arrow").css({"--translate-x":(115+35*(.5+s)+a.x)/2-20,"--rotate":"0deg"})):($("#run_in_gzmtr #big_next_2").find("g:eq(1), g:eq(3)").css("--translate-x",113),$("#run_in_gzmtr use#arrow").css({"--translate-x":(99+27*(1+s)+a.x)/2-20,"--rotate":"0deg"})),$("#run_in_gzmtr #big_next g:first-child").css("--translate-x",80),$("#run_in_gzmtr #big_next_2").find("g:eq(0), g:eq(2)").css("--translate-x",72)):($("#run_in_gzmtr #platform").css("--translate-x",100),1===t.length?($("#run_in_gzmtr #big_next g:nth-child(2)").css("--translate-x",this._svgDestWidth-45-h.width),s<=2?($("#run_in_gzmtr #big_next g:first-child").css("--translate-x",this._svgDestWidth-45-h.width-70),$("#run_in_gzmtr use#arrow").css({"--translate-x":(this._svgDestWidth-45-h.width-70-35+a.x+a.width+55+25.9)/2+20,"--rotate":"180deg"})):($("#run_in_gzmtr #big_next g:first-child").css("--translate-x",this._svgDestWidth-45-h.width-52.5),$("#run_in_gzmtr use#arrow").css({"--translate-x":(this._svgDestWidth-45-h.width-87.5+a.x+a.width+55+25.9)/2+20,"--rotate":"180deg"}))):($("#run_in_gzmtr #big_next_2").find("g:eq(1), g:eq(3)").css("--translate-x",this._svgDestWidth-45-h.width),$("#run_in_gzmtr #big_next_2").find("g:eq(0), g:eq(2)").css("--translate-x",this._svgDestWidth-45-h.width-41),$("#run_in_gzmtr use#arrow").css({"--translate-x":(this._svgDestWidth-45-h.width-41-27+a.x+a.width+55+25.9)/2+20,"--rotate":"180deg"})))}addStn(t,e,n,i){var s=super.addStn(t,e,n,i);return this.loadLineNum(),this.loadDirection(),s}removeStn(t){return!!super.removeStn(t)&&(this.loadLineNum(),this.loadDirection(),!0)}updateStnTransfer(t,e,n=null){super.updateStnTransfer(t,e,n),this.loadLineNum()}updateBranchType(t,e,n){return!!super.updateBranchType(t,e,n)&&(this.loadLineNum(),this.loadDirection(),!0)}updateBranchFirst(t,e,n){return!!super.updateBranchFirst(t,e,n)&&(this.loadLineNum(),this.loadDirection(),!0)}updateBranchPos(t,e,n){return!!super.updateBranchPos(t,e,n)&&(this.loadLineNum(),this.loadDirection(),!0)}static initSVG(t){super.initSVG(t),t.loadLineNum(),t.loadLineName(),t.loadDirection()}}}}]);